<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุงููุจูุนุงุช ุงูุฒุฌุงุฌู</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4e54c8">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="intro-overlay">
        <h1>โจ ูู ุตููุช ุนูู ูุญูุฏ ูุขู ูุญูุฏ ุงููููุ โจ</h1>
        <p style="color:white; opacity:0.8">ุงูููู ุตููู ุนูู ูุญูุฏ ูุขู ูุญูุฏ</p>
    </div>

    <div id="customAlert" class="custom-alert-box"></div>

    <div id="pinModal" class="pin-modal">
        <div class="pin-box">
            <h3>๐ ุญูุงูุฉ ุงููุธุงู</h3>
            <p>ุฃุฏุฎู ุฑูุฒ ุงูุญูุงูุฉ ููุญุฐู (121)</p>
            <input type="password" id="securityPin" placeholder="ุงูุฑูุฒ ุงูุณุฑู" style="text-align:center; letter-spacing:5px; font-size:1.2em">
            <div style="display:flex; gap:10px;">
                <button class="action-btn" onclick="verifyPin()">ุชุฃููุฏ</button>
                <button class="delete-btn" onclick="closePinModal()">ุฅูุบุงุก</button>
            </div>
        </div>
    </div>

    <div id="pwa-install-banner" class="glass-panel" style="display:none; position:fixed; bottom:0; left:0; right:0; z-index:2000; margin:0; border-radius:15px 15px 0 0; flex-direction: column; align-items: center; text-align: center;">
        <p>ุญูู ุงูุชุทุจูู ุงูุขู ูุฃุฏุงุก ุฃูุถู ูุชุดุบูู ุจุฏูู ุฅูุชุฑูุช</p>
        <div style="display:flex; gap:10px; width:100%">
            <button class="action-btn" id="installBtn">ุชุซุจูุช ุงูุชุทุจูู</button>
            <button class="delete-btn" onclick="document.getElementById('pwa-install-banner').style.display='none'">ุชุฎุทู</button>
        </div>
    </div>

    <nav class="navbar glass-panel">
        <button class="nav-btn active" onclick="switchTab('products')"><i class="fas fa-box"></i> ุงูุณูุน</button>
        <button class="nav-btn" onclick="switchTab('customers')"><i class="fas fa-users"></i> ุงูุฒุจุงุฆู</button>
        <button class="nav-btn" onclick="switchTab('sales')"><i class="fas fa-shopping-cart"></i> ุจูุน</button>
        <button class="nav-btn" onclick="switchTab('records')"><i class="fas fa-file-invoice"></i> ุงูุณุฌูุงุช</button>
        <button class="nav-btn" onclick="switchTab('expenses')"><i class="fas fa-money-bill-wave"></i> ุตุฑููุงุช ุงูููู</button>
        <button class="nav-btn" onclick="switchTab('debtors')"><i class="fas fa-hand-holding-usd"></i> ุงููุฏูู</button>
        <button class="nav-btn" onclick="switchTab('settings')"><i class="fas fa-cog"></i> ุงูุฅุนุฏุงุฏุงุช</button>
    </nav>

    <div class="container" style="max-width: 800px; margin: auto;">

        <div id="products" class="tab-content active">
            <div class="glass-panel">
                <h3><i class="fas fa-plus-circle"></i> ุฅุถุงูุฉ ุณูุนุฉ</h3>
                <input type="text" id="prodName" placeholder="ุงุณู ุงูุณูุนุฉ">
                <input type="number" id="prodPrice" placeholder="ุณุนุฑ ุงูููุฑุฏ">
                <input type="number" id="prodWholesale" placeholder="ุณุนุฑ ุงูุฌููุฉ">
                <input type="number" id="prodQty" placeholder="ุงููููุฉ">
                <button class="action-btn" onclick="addProduct()">ุญูุธ ุงูุณูุนุฉ</button>
            </div>
            <div class="glass-panel">
                <h3>ูุงุฆูุฉ ุงูุณูุน</h3>
                <div id="productsList"></div>
            </div>
        </div>

        <div id="customers" class="tab-content">
            <div class="glass-panel">
                <h3><i class="fas fa-user-plus"></i> ุฅุถุงูุฉ ุฒุจูู</h3>
                <input type="text" id="custName" placeholder="ุงุณู ุงูุฒุจูู">
                <input type="text" id="custPhone" placeholder="ุฑูู ุงููุงุชู (ูุซุงู: 780...)">
                <input type="text" id="custAddress" placeholder="ุงูุนููุงู">
                <button class="action-btn" onclick="addCustomer()">ุญูุธ ุงูุฒุจูู</button>
            </div>
            
            <div class="glass-panel">
                <input type="text" id="custSearch" onkeyup="renderCustomers()" placeholder="ุจุญุซ ุนู ุฒุจูู...">
                <div id="customersList"></div>
            </div>
        </div>

        <div id="sales" class="tab-content">
            <div class="glass-panel">
                <h3><i class="fas fa-cash-register"></i> ูุงุชูุฑุฉ ุฌุฏูุฏุฉ</h3>
                
                <label>ููุน ุงูุณุนุฑ:</label>
                <select id="salePriceType" style="margin-bottom: 10px;">
                    <option value="retail">ุณุนุฑ ุงูููุฑุฏ</option>
                    <option value="wholesale">ุณุนุฑ ุงูุฌููุฉ</option>
                </select>

                <label>ุจุญุซ ูุงุฎุชูุงุฑ ุงูุฒุจูู:</label>
                <input type="text" id="saleCustSearch" list="custDataList" placeholder="ุงุจุญุซ ุนู ุงุณู ุงูุฒุจูู..." oninput="selectCustomerFromSearch()">
                <datalist id="custDataList"></datalist>
                <input type="hidden" id="selectedCustId">

                <div style="border-top: 1px solid rgba(255,255,255,0.2); margin: 15px 0;"></div>

                <label>ุฅุถุงูุฉ ููุชุฌุงุช ููุณูุฉ:</label>
                <input type="text" id="saleProdSearch" list="prodDataList" placeholder="ุงุจุญุซ ุนู ุณูุนุฉ (ุงูุชุจ ุฃูู ุญุฑู)..." oninput="checkProductStock()">
                <datalist id="prodDataList"></datalist>
                
                <div id="stockDisplay" style="font-size: 0.9em; color: #ffeb3b; margin: 5px 0; display:none;">
                    ุงููุชููุฑ ูู ุงููุฎุฒูู: <span id="currentStockVal">0</span>
                </div>

                <input type="number" id="saleQty" placeholder="ุงููููุฉ" value="1">
                <button class="action-btn" onclick="addToCart()"><i class="fas fa-plus"></i> ุฃุถู ููุณูุฉ</button>

                <div id="currentCart" style="margin-top: 20px; background: rgba(0,0,0,0.1); padding: 10px; border-radius: 10px;">
                    <h4>ูุญุชููุงุช ุงููุงุชูุฑุฉ:</h4>
                    <div id="cartItems"></div>
                    <hr>
                    <div style="display: flex; justify-content: space-between; font-weight: bold;">
                        <span>ุงููุฌููุน ุงูููู:</span>
                        <span id="cartTotal">0</span>
                    </div>
                </div>

                <div style="margin-top: 15px;">
                    <input type="number" id="amountPaid" placeholder="ุงููุจูุบ ุงููุงุตู (ุงูุชุณุฏูุฏ)">
                    <button class="action-btn" style="background: linear-gradient(90deg, #11998e, #38ef7d);" onclick="checkout()">ุญูุธ ูุฅูุดุงุก ุงููุงุชูุฑุฉ</button>
                </div>
            </div>
        </div>

        <div id="records" class="tab-content">
            <div id="recordsCustomerList" class="glass-panel">
                <h3>ุณุฌูุงุช ุงูุฒุจุงุฆู ูุงูุฏููู</h3>
                <input type="text" id="recordSearch" onkeyup="renderRecordsCustomers()" placeholder="ุจุญุซ ูู ุงูุณุฌูุงุช...">
                <div id="recordsListContainer"></div>
            </div>

            <div id="customerRecordsDetail" class="glass-panel" style="display:none;">
                <button class="delete-btn" onclick="closeCustomerRecords()" style="margin-bottom:10px;">ุฑุฌูุน ูููุงุฆูุฉ</button>
                <div style="background: rgba(0,0,0,0.2); padding:15px; border-radius:10px; margin-bottom:15px;">
                    <h3 id="recCustName"></h3>
                    <p>ุฅุฌูุงูู ุงูุฏููู ุงููุชุจููุฉ: <strong id="recTotalDebt" style="color:#ff416c; font-size:1.2em;">0</strong></p>
                    
                    <div style="display:flex; gap:10px; align-items:center; margin-top:10px;">
                        <input type="number" id="payDebtAmount" placeholder="ูุจูุบ ุงูุชุณุฏูุฏ" style="margin:0;">
                        <button class="action-btn" onclick="payDebt()" style="width:auto;">ุชุณุฏูุฏ</button>
                    </div>
                </div>
                <h4>ุณุฌู ุงูููุงุชูุฑ ูุงูุฏูุนุงุช:</h4>
                <div id="custSpecificInvoices"></div>
            </div>
        </div>

        <div id="expenses" class="tab-content">
            <div class="glass-panel">
                <h3 style="text-align:center; margin:0;">ุฑุตูุฏ ูุจูุนุงุช ุงูููู</h3>
                <h2 style="text-align:center; color:#00b09b; margin-top:5px;" id="todaySalesBalance">0</h2>
            </div>
            <div class="glass-panel">
                <h3><i class="fas fa-money-bill-wave"></i> ุฅูุดุงุก ูุตุฑูู</h3>
                <input type="number" id="expAmount" placeholder="ุงููุจูุบ">
                <input type="text" id="expNotes" placeholder="ุงูููุงุญุธุงุช (ุงุฎุชูุงุฑู)">
                <button class="action-btn" onclick="addExpense()">ุญูุธ ุงููุตุฑูู</button>
            </div>
            <div class="glass-panel">
                <h3>ุณุฌู ุตุฑููุงุช ุงูููู</h3>
                <div id="expensesList"></div>
            </div>
        </div>

        <div id="debtors" class="tab-content">
            <div id="debtorsMain" class="glass-panel">
                <h3><i class="fas fa-user-tag"></i> ุฅูุดุงุก ูุฏูู</h3>
                <input type="number" id="debtorAmount" placeholder="ุงููุจูุบ ุงูููู / ุงูุฑุตูุฏ">
                <input type="text" id="debtorNotes" placeholder="ุงูููุงุญุธุงุช (ุงุณู ุงููุฏูู ุฃู ุงูุชูุงุตูู)">
                <button class="action-btn" onclick="addDebtor()">ุญูุธ ุงููุฏูู</button>
                <hr>
                <h3>ูุงุฆูุฉ ุงููุฏูููู</h3>
                <div id="debtorsList"></div>
            </div>
            <div id="debtorDetail" class="glass-panel" style="display:none;">
                <button class="delete-btn" onclick="closeDebtor()" style="margin-bottom:10px;">ุฑุฌูุน ูููุงุฆูุฉ</button>
                <div style="background: rgba(0,0,0,0.2); padding:15px; border-radius:10px; margin-bottom:15px;">
                    <h3 id="detDebtorNotes"></h3>
                    <p>ุงูุฑุตูุฏ ุงูููู: <strong id="detDebtorBalance" style="color:#ff416c; font-size:1.2em;">0</strong></p>
                    
                    <div style="display:flex; gap:10px; align-items:center; margin-top:10px;">
                        <input type="number" id="debtorPayAmount" placeholder="ุฃุถู ุงููุจูุบ ููุชุณุฏูุฏ" style="margin:0;">
                        <button class="action-btn" onclick="payDebtor()" style="width:auto;"><i class="fas fa-plus"></i> ุชุณุฏูุฏ</button>
                    </div>
                </div>
                <h4>ุณุฌู ุงููุนุงููุงุช:</h4>
                <div id="debtorTransactions"></div>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="glass-panel">
                <h3>๐ ุงููููู ุงููุงูู (ุงูุฅุญุตุงุฆูุงุช)</h3>
                <div style="margin-bottom: 10px;">
                    <label>ุนุฑุถ ุญุณุจ ุงูุดูุฑ:</label>
                    <select id="statsMonthSelect" onchange="calculateFinancialStats()">
                        <option value="all">ูู ุงูุฃุดูุฑ</option>
                        <option value="1">ููุงูุฑ (1)</option>
                        <option value="2">ูุจุฑุงูุฑ (2)</option>
                        <option value="3">ูุงุฑุณ (3)</option>
                        <option value="4">ุฃุจุฑูู (4)</option>
                        <option value="5">ูุงูู (5)</option>
                        <option value="6">ููููู (6)</option>
                        <option value="7">ููููู (7)</option>
                        <option value="8">ุฃุบุณุทุณ (8)</option>
                        <option value="9">ุณุจุชูุจุฑ (9)</option>
                        <option value="10">ุฃูุชูุจุฑ (10)</option>
                        <option value="11">ููููุจุฑ (11)</option>
                        <option value="12">ุฏูุณูุจุฑ (12)</option>
                    </select>
                </div>
                <div class="finance-dashboard">
                    <div class="finance-card" style="border-bottom: 3px solid #00b09b;">
                        <h4>ูุฌููุน ุงููุญุตูู (ุงููุงุตู)</h4>
                        <div id="totalRevenueDisplay" style="color:#00b09b">0</div>
                    </div>
                    <div class="finance-card" style="border-bottom: 3px solid #ff416c;">
                        <h4>ูุฌููุน ุงูุฏููู (ุงูุจุงูู)</h4>
                        <div id="totalDebtDisplay" style="color:#ff416c">0</div>
                    </div>
                </div>
                <button class="delete-btn" style="width:100%; margin-top:5px; background: #555;" onclick="resetStatsFilter()">๐ ุชุตููุฑ ุงูุนุฏุงุฏุงุช (ุฅุนุงุฏุฉ ุงูุญุณุงุจ)</button>
            </div>

            <div class="glass-panel">
                <h3>ุฅุนุฏุงุฏุงุช ุงููุชุฌุฑ</h3>
                <label>ุงุณู ุงููุญู / ุงูุดุฑูุฉ:</label>
                <input type="text" id="shopName" placeholder="ุฃุฏุฎู ุงุณู ุงููุชุฌุฑ">
                
                <label>ุฑูู ูุงุชู ุงููุชุฌุฑ:</label>
                <input type="text" id="shopPhone" placeholder="ุฑูู ุงููุงุชู">
                
                <button class="action-btn" onclick="saveSettings()">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
                
                <hr>
                
                <h3>๐พ ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ</h3>
                <p style="font-size:0.9em; opacity:0.8;">ูู ุจุชุญููู ูุณุฎุฉ ูู ุจูุงูุงุชู ุฃู ุงุณุชุนุงุฏุชูุง.</p>
                <button class="action-btn" onclick="backupData()" style="background: linear-gradient(90deg, #f857a6, #ff5858); margin-bottom:10px;">
                    <i class="fas fa-download"></i> ุชุญููู ูุณุฎุฉ ุงุญุชูุงุทูุฉ
                </button>
                
                <label style="display:block; margin-top:10px;">ุงุณุชุนุงุฏุฉ ูุณุฎุฉ:</label>
                <input type="file" id="restoreFile" accept=".json">
                <button class="action-btn" onclick="restoreData()" style="background: linear-gradient(90deg, #4b6cb7, #182848);">
                    <i class="fas fa-upload"></i> ุฑูุน ูุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช
                </button>
            </div>
        </div>

    </div>

    <div id="invoiceModal" class="invoice-modal">
        <div class="invoice-box">
            <div id="printableArea">
                <h2 id="printShopName">ูุงุชูุฑุฉ ูุจูุนุงุช</h2>
                <p id="printShopPhone" style="font-size:0.8em;"></p>
                <p>ุงูุชุงุฑูุฎ: <span id="invDate"></span></p>
                <p>ุงูุฒุจูู: <span id="invCust"></span></p>
                <hr>
                <table style="width:100%; text-align: right; border-collapse: collapse;">
                    <thead><tr><th>ุงููุงุฏุฉ</th><th>ุงูุนุฏุฏ</th><th>ุงูุณุนุฑ</th></tr></thead>
                    <tbody id="invItems"></tbody>
                </table>
                <hr>
                <p>ุงููุฌููุน: <span id="invTotal"></span></p>
                <p>ุงููุงุตู: <span id="invPaid"></span></p>
                <p>ุงูุจุงูู: <span id="invRem"></span></p>
            </div>
            
            <div class="invoice-actions no-print">
                <button class="action-btn" style="background: #25D366;" onclick="sendWhatsApp()">ูุงุชุณุงุจ <i class="fab fa-whatsapp"></i></button>
                <button class="action-btn" style="background: #333;" onclick="window.print()">ุทุจุงุนุฉ <i class="fas fa-print"></i></button>
                <button class="action-btn" style="background: #ff416c; width: 100%;" onclick="closeInvoice()">ุฅุบูุงู</button>
            </div>
        </div>
    </div>

    <script type="module" src="firebase-config.js"></script>
    <script src="script.js"></script>
    <script>
        // ุชุณุฌูู Service Worker ููุนูู ุฃูููุงูู
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
            .then(() => console.log("ุชู ุชุณุฌูู Service Worker ุจูุฌุงุญ!"))
            .catch(err => console.log("ุฎุทุฃ ูู ุชุณุฌูู Service Worker:", err));
        }
    </script>
</body>
</html>
